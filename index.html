<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Reference</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #f8f8f2;
  background-color: #272822;
}
.highlight .err {
  color: #151515;
  background-color: #ac4142;
}
.highlight .c, .highlight .cd, .highlight .cm, .highlight .c1, .highlight .cs {
  color: #505050;
}
.highlight .cp {
  color: #f4bf75;
}
.highlight .nt {
  color: #f4bf75;
}
.highlight .o, .highlight .ow {
  color: #d0d0d0;
}
.highlight .p, .highlight .pi {
  color: #d0d0d0;
}
.highlight .gi {
  color: #90a959;
}
.highlight .gd {
  color: #ac4142;
}
.highlight .gh {
  color: #6a9fb5;
  background-color: #151515;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #aa759f;
}
.highlight .kc {
  color: #d28445;
}
.highlight .kt {
  color: #d28445;
}
.highlight .kd {
  color: #d28445;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #90a959;
}
.highlight .sr {
  color: #75b5aa;
}
.highlight .si {
  color: #8f5536;
}
.highlight .se {
  color: #8f5536;
}
.highlight .nn {
  color: #f4bf75;
}
.highlight .nc {
  color: #f4bf75;
}
.highlight .no {
  color: #f4bf75;
}
.highlight .na {
  color: #6a9fb5;
}
.highlight .m, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mb, .highlight .mx {
  color: #90a959;
}
.highlight .ss {
  color: #90a959;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[&quot;code&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" />
        <div class="lang-selector">
              <a href="#" data-language-name="code">code</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='https://github.com/tripit/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="overview">Overview</h1>

<p>This specification describes a
<a href="http://en.wikipedia.org/wiki/Hooking">&ldquo;hook&rdquo;</a>-based pattern for invoking
decision support from within a clinician&rsquo;s EHR workflow. The API supports:</p>

<ul>
<li>Synchronous, workflow-triggered CDS calls returning information and suggestions</li>
<li>Launching a user-facing SMART app when CDS requires deeper interaction</li>
<li>Long-running, non-modal CDS sessions that observe EHR activity in progress</li>
</ul>

<aside class="notice">
The CDS Hooks API is still in active development and thus subject to change. We&rsquo;re currently working towards a 1.0 release and would love your feedback and proposed changes. Look at our <a href="http://github.com/cds-hooks/docs/issues">current issue list</a> and get involved!
</aside>

<h2 id="how-it-works">How it works</h2>

<p>User activity inside the EHR triggers <strong>CDS hooks</strong> in real-time.  For example:</p>

<ul>
<li><code class="prettyprint">patient-view</code> when opening a new patient record</li>
<li><code class="prettyprint">medication-prescribe</code> on authoring a new prescription</li>
<li><code class="prettyprint">order-review</code> on viewing pending orders for approval</li>
</ul>

<p>When a triggering activity occurs, the EHR notifies each CDS service registered for the activity. These services must then provide near-real-time feedback about the triggering event. Each service gets basic details about the EHR
context (via the <code class="prettyprint">context</code> parameter of the hook) plus whatever
service-specific data are required (via the <code class="prettyprint">pre-fetch-template</code> parameter).</p>

<p><img alt="CDS Hooks Overview" src="images/overview.png" /></p>

<h2 id="cds-cards">CDS Cards</h2>

<p>Each CDS service can return any number of <strong>cards</strong> in response to the hook.
Cards convey some combination of text (<em>information card</em>), alternative
suggestions (<em>suggestion card</em>), and links to apps or reference
materials (<em>app link card</em>). A user sees these cards — one or more of each type
— embedded in the EHR, and can interact with them as follows:</p>

<ul>
<li><p><em>information card</em>: provides text for the user to read.</p></li>
<li><p><em>suggestion card</em>: provides a specific suggestion for which the EHR renders a button that the user can click to accept. Clicking automatically populates the suggested change into the EHR&rsquo;s UI.</p></li>
<li><p><em>app link card</em>: provides a link to an app (often a SMART app) where the user can supply details, step through a flowchart, or do anything else required to help reach an informed decision. When the user has finished, flow returns to the EHR. At that point, the <strong>EHR re-triggers the initial CDS hook</strong>. The re-triggering may result in different cards, and may also include <strong>decisions</strong> (see below).</p></li>
</ul>

<h2 id="cds-decisions">CDS Decisions</h2>

<p>In addition to cards, a CDS service may also return <strong>decisions</strong> — but only
after a user has interacted with the service via an <em>app link card</em>.
Returning a decision allows the the CDS service to communicate the user&rsquo;s choices  to the EHR without displaying an additional card.  For
example, a user might launch a hypertension management app, and upon
returning to the EHR&rsquo;s prescription page she expects her new blood pressure
prescription to &ldquo;just be there&rdquo;. By returning a decision <em>instead of a card</em>,
the CDS service achieves this expected behavior. (<em>Note:</em> To return a
decision after a user interaction, the CDS service must maintain state
associated with the request&rsquo;s <code class="prettyprint">hookInstance</code>;
when the EHR invokes the hook for a second time with the same
<code class="prettyprint">hookInstance</code>, the service can respond with decisions on as well as cards.)</p>

<h1 id="try-it">Try it!</h1>

<p>You can try CDS Hooks in our test harness at <strong><a href="http://sandbox.cds-hooks.org">http://sandbox.cds-hooks.org</a></strong></p>

          <h1 id="cds-services">CDS Services</h1>

<h2 id="discovery">Discovery</h2>
<pre class="highlight shell"><code>curl <span class="s2">"https://example.com/cds-services"</span>
</code></pre>

<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"services"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"hook"</span><span class="p">:</span><span class="w"> </span><span class="s2">"patient-view"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Static CDS Service Example"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"An example of a CDS service that returns a static set of cards"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"static-patient-greeter"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"prefetch"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"patientToGreet"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient/{{Patient.id}}"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"hook"</span><span class="p">:</span><span class="w"> </span><span class="s2">"medication-prescribe"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Medication Echo CDS Service"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"An example of a CDS service that simply echos the medication being prescribed"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"medication-echo"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"prefetch"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"patient"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient/{{Patient.id}}"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"medications"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MedicationOrder?patient={{Patient.id}}"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Developers of CDS Services must provide a well-known endpoint allowing the EHR to discover all available CDS Services, including information such as the purpose of the CDS Service, when it should be invoked, and any data that is requested to be prefetched.</p>

<h3 id="http-request">HTTP Request</h3>

<p>The discovery endpoint is always available at <code class="prettyprint">{baseUrl}/cds-services</code>. For example, if the <code class="prettyprint">baseUrl</code> is https://example.com, the EHR would invoke:</p>

<p><code class="prettyprint">GET https://example.com/cds-services</code></p>

<h3 id="response">Response</h3>

<p>The response to the discovery endpoint is an object containing a list of CDS Services.</p>

<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">services</code></td>
<td><em>array</em>. An array of <strong>CDS Services</strong></td>
</tr>
</tbody></table>

<p>Each CDS Service is described by the following attributes.</p>

<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">hook</code></td>
<td><em>string</em> or <em>url</em>. The hook this service should be invoked on. See <a href="#hook-catalog">Hook Catalog</a></td>
</tr>
<tr>
<td><code class="prettyprint">title</code></td>
<td><em>string</em>.  The human-friendly name of this service</td>
</tr>
<tr>
<td><nobr><code class="prettyprint">description</code></nobr></td>
<td><em>string</em>. The description of this service</td>
</tr>
<tr>
<td><code class="prettyprint">id</code></td>
<td><em>string</em>. The {id} portion of the URL to this service which is available at<br /><code class="prettyprint">{baseUrl}/cds-services/{id}</code></td>
</tr>
<tr>
<td><code class="prettyprint">prefetch</code></td>
<td><em>object</em>. An object containing key/value pairs of FHIR queries to data that this service would like the EHR prefetch and provide on<br />each service call. The key is a <em>string</em> that describes the type<br />of data being requested and the value is a <em>string</em> representing<br />the FHIR query.<br />(todo: link to prefetching documentation)</td>
</tr>
</tbody></table>

<h3 id="http-status-codes">HTTP Status Codes</h3>

<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">200 OK</code></td>
<td>A successful response</td>
</tr>
</tbody></table>

<h2 id="calling-a-cds-service">Calling a CDS Service</h2>
<pre class="highlight plaintext"><code>curl
  -X POST \
  -H 'Content-type: application/json' \
  --data @hook-details-see-example-below
  "https://example.com/cds-services/static-patient-greeter"
</code></pre>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
   </span><span class="nt">"hookInstance"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"d1577c69-dfbe-44ad-ba6d-3e05e953b2ea"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"fhirServer"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://hooks.smarthealthit.org:9080"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"hook"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"patient-view"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"redirect"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://hooks2.smarthealthit.org/service-done.html"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"user"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Practitioner/example"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"context"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
   </span><span class="nt">"patient"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1288992"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"prefetch"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"patientToGreet"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
         </span><span class="nt">"response"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"200 OK"</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nt">"resource"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"resourceType"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"gender"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"male"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"birthDate"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1925-12-23"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1288992"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"active"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
         </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p>An EHR calls a CDS service by <code class="prettyprint">POST</code>ing a JSON document to the service
endpoint, which can be constructed from the CDS Service base URL and an
individual service id as <code class="prettyprint">{baseUrl}/cds-services/{service.id}</code>.  The CDS Hook
call includes a JSON POST body with the following input fields:</p>

<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">hook</code></td>
<td><em>string</em> or <em>URL</em>. The hook that triggered this CDS Service call<br />(todo: link to hook documentation)</td>
</tr>
<tr>
<td><nobr><code class="prettyprint">hookInstance</code></nobr></td>
<td><em>string</em>.  A UUID for this particular hook call (see more information below)</td>
</tr>
<tr>
<td><code class="prettyprint">fhirServer</code></td>
<td><em>URL</em>.  The base URL EHR&rsquo;s <a href="https://www.hl7.org/fhir/">FHIR</a> server. The scheme should be <code class="prettyprint">https</code></td>
</tr>
<tr>
<td><code class="prettyprint">oauth</code></td>
<td><em>object</em>. The OAuth2 authorization providing access to the EHR&rsquo;s FHIR server (see more information below)</td>
</tr>
<tr>
<td><code class="prettyprint">redirect</code></td>
<td><em>URL</em>.  The URL an app link card should redirect to (see more information below)</td>
</tr>
<tr>
<td><code class="prettyprint">user</code></td>
<td><em>string</em>.  The FHIR resource type + id representing the current user.<br />The type is one of: <a href="https://www.hl7.org/fhir/practitioner.html">Practitioner</a>, <a href="https://www.hl7.org/fhir/patient.html">Patient</a>, or <a href="https://www.hl7.org/fhir/relatedperson.html">RelatedPerson</a>.<br />For example, <code class="prettyprint">Practitioner/123</code></td>
</tr>
<tr>
<td><code class="prettyprint">patient</code></td>
<td><em>string</em>.  The FHIR <code class="prettyprint">Patient.id</code> of the current patient in context</td>
</tr>
<tr>
<td><code class="prettyprint">encounter</code></td>
<td><em>string</em>.  The FHIR <code class="prettyprint">Encounter.id</code> of the current encounter in context</td>
</tr>
<tr>
<td><code class="prettyprint">context</code></td>
<td><em>object</em>.  Hook-specific contextual data that the CDS service will need.<br />For example, with the <code class="prettyprint">medication-prescribe</code> hook this will include <a href="https://www.hl7.org/fhir/medicationorder.html">MedicationOrder</a> being prescribed.</td>
</tr>
<tr>
<td><code class="prettyprint">prefetch</code></td>
<td><em>object</em>.  The FHIR data that was prefetched by the EHR (see more information below)</td>
</tr>
</tbody></table>

<h4 id="hookinstance">hookInstance</h4>

<p>While working in the EHR, a user can perform
multiple activities in series or in parallel. For example, a clinician might prescribe
two drugs in a row; each prescription activity would be assigned a
unique <code class="prettyprint">hookInstance</code>. The [[activity catalog|Activity]]
provides a description of what events should initiate and terminate
a given hook. This allows an external
service to associate requests with activity state, which is necessary to
support the following app-centric decision sequence, where
the steps are tied together by a common <code class="prettyprint">hookInstance</code>:</p>

<ol>
<li>EHR invokes CDS hook</li>
<li>CDS service returns <em>app link card</em></li>
<li>User clicks app link and interacts with app</li>
<li>Flow returns to EHR, which re-invokes CDS hook</li>
<li>CDS service returns <em>decision</em> with user&rsquo;s choice</li>
</ol>

<p>Note: the <code class="prettyprint">hookInstance</code> is globally unique and should contain enough entropy
to be un-guessable.</p>

<h4 id="oauth">oauth</h4>

<p>Security details allowing the CDS service to connect to the EHR&rsquo;s
FHIR server.  These fields allow the CDS service to access EHR data in a
context limited by the current user&rsquo;s privileges. <code class="prettyprint">expires</code> expresses the
token lifetime as an integer number of seconds. <code class="prettyprint">scope</code> represents the set of
scopes assigned to this token (see <a href="http://docs.smarthealthit.org/authorization/scopes-and-launch-context/">SMART on FHIR
scopes</a>).
Finally, <code class="prettyprint">token</code> is a bearer token to be presented with any API calls the CDS
service makes to the EHR, by including it in an Authorization header like:</p>

<p><code class="prettyprint">Authorization: Bearer {{token}}</code></p>

<h4 id="redirect">redirect</h4>

<p>This field is only used by services that will return an <em>app
link card</em>: when a user clicks the card&rsquo;s link to launch an app, it becomes
the app&rsquo;s job to send the user to <em>this <code class="prettyprint">redirect</code> URL</em> upon completion of
user interaction. (<em>Design note</em>: this field is supplied up-front, as part of
the initial request, to avoid requiring the EHR to append any content to app
launch links. This helps support an important &ldquo;degenerate&rdquo; use case for app
link cards: pointing to static content. See below for details.)</p>

<h4 id="prefetch">prefetch</h4>

<p>As a performance tweak, the EHR may pass along data according
to the service&rsquo;s [[Prefetch-Template]]. This helps provide the service with all
the data it needs to efficiently compute a set of recommendations. Each key matches a key described in the CDS Service Discovery document; and each value is a FHIR Bundle.entry indicating a response status and returned resource.</p>

<p>Note that in the absence of <code class="prettyprint">prefetch</code>, an external service can always execute
FHIR REST API calls against the EHR server to obtain additional data ad-hoc.)</p>

<aside class="notice">
You can see the <a href="http://editor.swagger.io/?url=https://raw.githubusercontent.com/cds-hooks/api/master/cds-hooks.yaml">complete data model in Swagger</a>.
</aside>

<h2 id="cds-service-response">CDS Service Response</h2>

<blockquote>
<p>Example response</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"cards"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"summary"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Example Card"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"indicator"</span><span class="p">:</span><span class="w"> </span><span class="s2">"info"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"detail"</span><span class="p">:</span><span class="w"> </span><span class="s2">"This is an example card."</span><span class="p">,</span><span class="w">
      </span><span class="nt">"source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Static CDS Service Example"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.com"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"icon"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.com/img/icon-100px.png"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"links"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Google"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://google.com"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"absolute"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Github"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://github.com"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"absolute"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SMART Example App"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://smart.example.com/launch"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"smart"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"summary"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Another card"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"indicator"</span><span class="p">:</span><span class="w"> </span><span class="s2">"warning"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Static CDS Service Example"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">cards</code></td>
<td><em>array</em>. An array of <strong>Cards</strong>. Cards can provide a combination of information (for reading), suggested actions (to be applied if a user selects them), and links (to launch an app if the user selects them). The EHR decides how to display cards, but we recommend displaying suggestions using buttons, and links using underlined text.</td>
</tr>
<tr>
<td><nobr><code class="prettyprint">decisions</code></nobr></td>
<td><em>array</em>. An array of <strong>Decisions</strong>. A decision should only be generated after interacting with the user through an app link. Decisions are designed to convey any choices the user made in an app session.</td>
</tr>
</tbody></table>

<p>represents a user&rsquo;s choice made while interacting with the CDS Provider&rsquo;s external app. The first call to a service should never include any <code class="prettyprint">decisions</code>, since no user interaction has occurred yet.</p>

<p>Each <strong>Card</strong> is described by the following attributes.</p>

<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">summary</code></td>
<td><em>string</em>. one-sentence, &lt;140-character summary message for display to the user inside of this card.</td>
</tr>
<tr>
<td><code class="prettyprint">detail</code></td>
<td><em>string</em>.  optional detailed information to display, represented in <a href="https://github.github.com/gfm/">(GitHub Flavored) Markdown</a>. (For non-urgent cards, the EHR may hide these details until the user clicks a link like &ldquo;view more details&hellip;&rdquo;.)</td>
</tr>
<tr>
<td><code class="prettyprint">indicator</code></td>
<td><em>string</em>.  urgency/importance of what this card conveys. Allowed values, in order of increasing urgency, are: <code class="prettyprint">info</code>, <code class="prettyprint">warning</code>, <code class="prettyprint">hard-stop</code>. The EHR can use this field to help make UI display decisions such as sort order or coloring. The value <code class="prettyprint">hard-stop</code> indicates that the workflow should not be allowed to proceed.</td>
</tr>
<tr>
<td><code class="prettyprint">source</code></td>
<td><em>object</em>. grouping structure for the <strong>Source</strong> of the information displayed on this card. The source should be the primary source of guidance for the decision support the card represents.</td>
</tr>
<tr>
<td><nobr><code class="prettyprint">suggestions</code></nobr></td>
<td><em>array</em> of <strong>Suggestions</strong>, which allow a service to suggest a set of changes in the context of the current activity (e.g.  changing the dose of the medication currently being prescribed, for the <code class="prettyprint">medication-prescribe</code> activity). Note that suggestions are implicitly OR&rsquo;d.</td>
</tr>
<tr>
<td><code class="prettyprint">links</code></td>
<td><em>array</em> of <strong>Links</strong>, which allow a service to suggest a link to an app that the user might want to run for additional information or to help guide a decision.</td>
</tr>
</tbody></table>

<p>The <strong>Source</strong> is described by the following attributes.</p>

<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><nobr><code class="prettyprint">label</code></nobr></td>
<td><em>string</em>. A short, human-readable label to display for the source of the information displayed on this card. If a <code class="prettyprint">url</code> is also specified, this may be the text for the hyperlink.</td>
</tr>
<tr>
<td><code class="prettyprint">url</code></td>
<td><em>URL</em>. An optional absolute URL to load (via <code class="prettyprint">GET</code>, in a browser context) when a user clicks on this link to learn more about the organization or data set that provided the information on this card. Note that this URL should not be used to supply a context-specific &ldquo;drill-down&rdquo; view of the information on this card. For that, use <code class="prettyprint">link.url</code> instead.</td>
</tr>
<tr>
<td><code class="prettyprint">icon</code></td>
<td><em>URL</em>. An optional absolute URL to an icon for the source of this card. The icon returned by this URL should be in PNG format, an image size of 100x100 pixels, and must not include any transparent regions.</td>
</tr>
</tbody></table>

<p>Each <strong>Suggestion</strong> is described by the following attributes.</p>

<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">label</code></td>
<td><em>string</em>. human-readable label to display for this suggestion (e.g. the EHR might render this as the text on a button tied to this suggestion).</td>
</tr>
<tr>
<td><code class="prettyprint">uuid</code></td>
<td><em>string</em>. unique identifier for this suggestion. For details see <a href="#analytics">Suggestion Tracking Analytics</a></td>
</tr>
<tr>
<td><code class="prettyprint">actions</code></td>
<td><em>array</em>. array of objects, each defining a suggested action. Within a suggestion, all actions are logically AND&rsquo;d together, such that a user selecting a suggestion selects all of the actions within it.</td>
</tr>
</tbody></table>

<p>Each <strong>Action</strong> is described by the following attributes.</p>

<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">type</code></td>
<td><em>string</em>. The type of action being performed. Allowed values are: <code class="prettyprint">create</code>, <code class="prettyprint">update</code>, <code class="prettyprint">delete</code>.</td>
</tr>
<tr>
<td><code class="prettyprint">description</code></td>
<td><em>string</em>. human-readable description of the suggested action. May be presented to the end-user.</td>
</tr>
<tr>
<td><code class="prettyprint">resource</code></td>
<td><em>object</em>. depending upon the <code class="prettyprint">type</code> attribute, new resource(s) or id(s) of resources. For a type of <code class="prettyprint">create</code>, the <code class="prettyprint">resource</code> attribute contains new FHIR resources to apply within the current activity (e.g. for <code class="prettyprint">medication-prescribe</code>, this holds the updated prescription as proposed by the suggestion).  For <code class="prettyprint">delete</code>, id(s) of any resources to remove from the current activity (e.g. for the <code class="prettyprint">order-review</code> activity, this would provide a way to remove orders from the pending list). In activities like <code class="prettyprint">medication-prescribe</code> where only one &ldquo;content&rdquo; resource is ever relevant, this field may be omitted. For <code class="prettyprint">update</code>, existing resources to modify from the current activity (e.g. for the <code class="prettyprint">order-review</code> activity, this would provide a way to annotate an order from the pending list with an assessment). This field may be omitted.</td>
</tr>
</tbody></table>

<p>Each <strong>Link</strong> is described by the following attributes.</p>

<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><nobr><code class="prettyprint">label</code></nobr></td>
<td><em>string</em>. human-readable label to display for this link (e.g. the EHR might render this as the underlined text of a clickable link).</td>
</tr>
<tr>
<td><code class="prettyprint">url</code></td>
<td><em>URL</em>. URL to load (via <code class="prettyprint">GET</code>, in a browser context) when a user clicks on this link. Note that this may be a &ldquo;deep link&rdquo; with context embedded in path segments, query parameters, or a hash. In general this URL should embed enough context for the app to determine the <code class="prettyprint">hookInstance</code>, and <code class="prettyprint">redirect</code> url upon downstream launch, because the EHR will simply use this url as-is, without appending any parameters at launch time.</td>
</tr>
<tr>
<td><code class="prettyprint">type</code></td>
<td><em>string</em>. The type of the given URL. There are two possible values for this field. A type of <code class="prettyprint">absolute</code> indicates that the URL is absolute and should be treated as-is. A type of <code class="prettyprint">smart</code> indicates that the URL is a SMART app launch URL and the EHR should ensure the SMART app launch URL is populated with the appropriate SMART launch parameters.</td>
</tr>
</tbody></table>

<p>Each <strong>Decision</strong> is described by the following attributes.</p>

<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">create</code></td>
<td><em>array</em> of <em>strings</em>. id(s) of new resource(s) that the EHR should create within the current activity (e.g. for <code class="prettyprint">medication-prescribe</code>, this would be the updated prescription that a user had authored in an app session).</td>
</tr>
<tr>
<td><nobr><code class="prettyprint">delete</code></nobr></td>
<td><em>array</em> of <em>strings</em>. id(s) of any resources to remove from the current activity (e.g. for the <code class="prettyprint">order-review</code> activity, this would provide a way to remove orders from the pending list). In activities like <code class="prettyprint">medication-prescribe</code> where only one &ldquo;content&rdquo; resource is ever relevant, this field may be omitted.</td>
</tr>
</tbody></table>

<h3 id="no-decision-support">No Decision Support</h3>

<blockquote>
<p>Response when no decision support is necessary for the user</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"cards"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>If your CDS Service has no decision support for the user, your service should return a 200 HTTP response with an empty array of cards.</p>

<h1 id="analytics">Analytics</h1>

<p>Whenever a user clicks a button from a &ldquo;suggestion&rdquo; card, the EHR uses the
suggestion <code class="prettyprint">uuid</code> to notify the CDS Service&rsquo;s analytics endpoint via a <code class="prettyprint">POST</code>
with an empty body:</p>

<p><code class="prettyprint">POST {baseUrl}/cds-services/{serviceId}/analytics/{uuid}</code></p>

<p>If a suggestion has no <code class="prettyprint">uuid</code>, the EHR does not send a notification.</p>

          <h1 id="prefetch">Prefetch</h1>

<h2 id="a-performance-tweak">A performance tweak</h2>

<p>If real-world performance were no issue, an EHR could launch a CDS Service
passing only <em>context</em> data, and <em>without passing any additional clinical data</em>
up-front. The CDS Service could then request any data it needed via the EHR&rsquo;s
FHIR REST API.</p>

<p>But CDS services must respond quickly (on the order of 500 ms), and so we
provide a performance tweak that allows a CDS Service to register a set of &ldquo;prefetch
templates&rdquo; with the EHR ahead of time.</p>

<p>The prefetch templates are a dictionary of <code class="prettyprint">read</code> and <code class="prettyprint">search</code> requests to supply
relevant data, where the following variables are defined:</p>

<table><thead>
<tr>
<th>variable</th>
<th>meaning</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">{{Patient.id}}</code></td>
<td>The id of the patient in context for this activity (e.g. <code class="prettyprint">123</code>)</td>
</tr>
<tr>
<td><code class="prettyprint">{{User.id}}</code></td>
<td>The type and id of the user for this session (e.g. <code class="prettyprint">Practitioner/123</code>)</td>
</tr>
</tbody></table>

<p>An EHR <em>may</em> choose to honor some or all of the desired prefetch templates from an appropriate source. For example:</p>

<ul>
<li>The EHR may have some of the desired prefetched data already in memory, thereby removing the need for any network call</li>
<li>The EHR may compute an efficient set of prefetch templates from multiple CDS Services, thereby reducing the number of network calls to a minimum</li>
<li>The EHR may satisfy some of the desired prefetched templates via some internal service or even its own FHIR server</li>
</ul>

<p>Regardless of how the EHR satisfies the prefetched templates (if at all), it is important that the prefetched data given to the CDS Service is equivalent to the CDS Service making its own call to the EHR FHIR server, where <code class="prettyprint">{{Patient.id}}</code> is replaced with the id of the current patient (e.g. <code class="prettyprint">123</code>) inside of any URL strings and using <code class="prettyprint">read</code> and <code class="prettyprint">search</code> operations to the server&rsquo;s &ldquo;transaction&rdquo; endpoint as a FHIR batch-type bundle.</p>

<p>The resulting response, which must be rendered in a single page — no &ldquo;next
page&rdquo; links allowed — is passed along to the CDS Service using the
<code class="prettyprint">prefetch</code> parameter (see below for a complete example). </p>

<p>The CDS Service must not receive any prefetch template key that the EHR chooses not to satisfy. Additionally, if the EHR encounters an error while retrieving any prefetched data, the prefetch template key should not be sent to the CDS Service. It is the CDS Service&rsquo;s responsibility to check to see what prefetched data was satisfied (if any) and manually retrieve any necessary data.</p>

<h2 id="example-prefetch-request">Example prefetch request</h2>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"prefetch"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"p"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient/{{Patient.id}}"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"a1c"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Observation?patient={{Patient.id}}&amp;code=4548-4&amp;_count=1&amp;sort:desc=date"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"u"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Practitioner/{{User.id}}"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Here is an example prefetch property from a CDS service discovery endpoint. The
goal is to know, at call time:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">p</code></td>
<td>Patient demographics</td>
</tr>
<tr>
<td><code class="prettyprint">a1c</code></td>
<td>Most recent Hemoglobin A1c reading for this patient</td>
</tr>
<tr>
<td><code class="prettyprint">u</code></td>
<td>Information on the current user (Practitioner)</td>
</tr>
</tbody></table>

<h2 id="example-prefetch-response">Example prefetch response</h2>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"prefetch"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"p"</span><span class="p">:{</span><span class="w">
      </span><span class="nt">"response"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"200 OK"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"resource"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"gender"</span><span class="p">:</span><span class="w"> </span><span class="s2">"male"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"birthDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1974-12-25"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"..."</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;snipped for brevity&gt;"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"a1c"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"response"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"200 OK"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"resource"</span><span class="p">:{</span><span class="w">
        </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bundle"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"searchset"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"entry"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
          </span><span class="nt">"resource"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Observation"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="nt">"coding"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
                </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://loinc.org"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4548-4"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"display"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hemoglobin A1c"</span><span class="w">
              </span><span class="p">}]</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"..."</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;snipped for brevity&gt;"</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">}]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The response is augmented to include two prefetch values, where the dictionary
keys match the request keys (<code class="prettyprint">p</code> and <code class="prettyprint">a1c</code> in this case).</p>

<p>Note that the missing <code class="prettyprint">u</code> key indicates that either the EHR has decided not to satisfy this particular prefetch template or it was not able to retrieve this prefetched data. The CDS Service is responsible for retrieving this Practitioner data from the FHIR server (if required).</p>

<h2 id="prefetch-query-restrictions">Prefetch query restrictions</h2>

<p>To reduce the implementation burden on EHRs that support CDS services, CDS Hooks recommends that prefetch queries only use a subset of the full functionality available in the FHIR specification. Valid prefetch URLs should only contain:</p>

<ul>
<li><em>instance</em> level <a href="https://www.hl7.org/fhir/http.html#read">read</a> interactions (for resources with known ids such as <code class="prettyprint">Patient</code> and <code class="prettyprint">Practitioner</code>)</li>
<li><em>type</em> level <a href="https://www.hl7.org/fhir/http.html#search">search</a> interactions</li>
<li>Patient references (e.g. <code class="prettyprint">patient={{Patient}}</code>)</li>
<li><em>token</em> search parameters using equality (e.g. <code class="prettyprint">code=4548-4</code>) and optionally the <code class="prettyprint">:in</code> modifier (no other modifiers for token parameters)</li>
<li><em>date</em> search parameters on <code class="prettyprint">date</code>, <code class="prettyprint">dateTime</code>, <code class="prettyprint">instant</code>, or <code class="prettyprint">Period</code> types only, and using only the prefixes <code class="prettyprint">eq</code>, <code class="prettyprint">lt</code>, <code class="prettyprint">gt</code>, <code class="prettyprint">ge</code>, <code class="prettyprint">le</code></li>
<li>the <code class="prettyprint">_count</code> parameter to limit the number of results returned</li>
<li>the <code class="prettyprint">_sort</code> parameter to allow for <em>most recent</em> and <em>first</em> queries</li>
</ul>

          <h1 id="security">Security</h1>

<aside class="notice">
The proposed security model has not yet received implementer feedback and as such, is subject to change. Maintaining both a secure model and an easy implementation experience is a key concern of our impending 1.0 release. As such, we encourage open feedback on this proposed approach on <a href="https://github.com/cds-hooks/docs/issues/7">this Github issue</a> from all of our stakeholders.
</aside>

<p>CDS Hooks defines the agreed upon security model between an EHR and the CDS Service. Like SMART on FHIR, the security model of CDS Hooks leverages the same open and well supported standards like OAuth 2 and JSON web tokens. However, as CDS Hooks differs from SMART, the manny in which these standards are used is specific to CDS Hooks.</p>

<h2 id="trusting-cds-services">Trusting CDS Services</h2>

<p>As the EHR initiates every interaction with the CDS Service, it is responsible for establishing trust with the CDS Services it intends to call. This trust is established via a TLS connection to the CDS Service. Thus, all CDS Service endpoints must be deployed to a TLS protected URL (https). This includes both the Discovery and individual CDS Service endpoints.</p>

<p>EHRs should use accepted best practices for verifying the authenticity and trust of these TLS connections. For instance, <a href="https://tools.ietf.org/html/rfc5280">rfc5280</a> and <a href="https://tools.ietf.org/html/rfc6125">rfc6125</a>. Additionally, it is assumed that EHRs configure the CDS Services they connect to via some offline process according to the business rules and practices of both the EHR and CDS Service organizations.</p>

<h2 id="trusting-ehrs">Trusting EHRs</h2>

<p>Since the CDS Service is invoked by the EHR, the CDS Service does not have the same mechanism as EHRs to establish trust of the EHR invoking it. To establish trust of the EHR, <a href="https://jwt.io/">JSON web tokens (JWT)</a> are used. Specifically, the JWT is the same <code class="prettyprint">id_token</code> used in SMART on FHIR.</p>

<p>Each time the EHR makes a request to the CDS Service, it should send an <code class="prettyprint">Authorization</code> header where the value is <code class="prettyprint">Bearer &lt;token&gt;</code>, replacing <code class="prettyprint">&lt;token&gt;</code> with the actual JWT. Note that this is for every single CDS Service call, whether that be Discovery calls, CDS Service invocations, etc.</p>

<blockquote>
<p>Example JSON web token payload</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"iss"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://fhir-ehr.example.com/"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"sub"</span><span class="p">:</span><span class="w"> </span><span class="s2">"some-username"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"aud"</span><span class="p">:</span><span class="w"> </span><span class="s2">"44b16507-8a59-4369-96f9-1e9b1f9a0ace"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"exp"</span><span class="p">:</span><span class="w"> </span><span class="mi">1422568860</span><span class="p">,</span><span class="w">
  </span><span class="nt">"iat"</span><span class="p">:</span><span class="w"> </span><span class="mi">1311280970</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>Using the above JWT payload, the complete JWT as passed in the Authorization HTTP header would be:</p>
</blockquote>
<pre class="highlight plaintext"><code>Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJodHRwczovL2ZoaXItZWhyLmV4YW1wbGUuY29tLyIsImF1ZCI6Imh0dHBzOi8vY2RzLmV4YW1wbGUub3JnL2Nkcy1zZXJ2aWNlcyIsImV4cCI6MTQyMjU2ODg2MCwianRpIjoiMmFmNWU4YTUtYjVlZi00ZmQwLThkOTMtYzU2MGRhYzQwYzk4In0.ahR57rtcMFhvrHEEo9w13vVdLrhZs_gRY2NV6R2GAoU
</code></pre>

<p>The JWT from the EHR is signed with the EHR&rsquo;s private key and contains the following fields:</p>

<table><thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead><tbody>
<tr>
<td>iss</td>
<td>The base URL of the EHR&rsquo;s FHIR server. This must be the same URL as the <code class="prettyprint">fhirServer</code> field in a CDS Service request.</td>
</tr>
<tr>
<td>sub</td>
<td>The unique identifer for the current user</td>
</tr>
<tr>
<td>aud</td>
<td>The OAuth 2 client id of the CDS Service</td>
</tr>
<tr>
<td>exp</td>
<td>Expiration time integer for this authentication JWT, expressed in seconds since the &ldquo;Epoch&rdquo; (1970-01-01T00:00:00Z UTC).</td>
</tr>
<tr>
<td>iat</td>
<td>The time at which this JWT was issued, expressed in seconds since the &ldquo;Epoch&rdquo; (1970-01-01T00:00:00Z UTC).</td>
</tr>
</tbody></table>

<p>Note that the use of JWT in CDS Hooks resembles the <a href="http://docs.smarthealthit.org/authorization/backend-services/">SMART on FHIR Backend Services</a> usage of JWT. However, there are differences due to the differing use cases and concerns between CDS Hooks and SMART Backend Services.</p>

<p><a href="https://jwt.io/">https://jwt.io/</a> is a great resource not only for learning about JSON web tokens, but also for parsing a JWT value into its distinct parts to see how it is constructed. Try taking the example JWT here and pasting it into the form at <a href="https://jwt.io/">https://jwt.io/</a> to see how the token is constructed.</p>

<aside class="notice">
TODO: Need to propose how the EHR public key is discovered. Preference would be a further extension in the EHR FHIR server Conformance resource.
</aside>

<aside class="notice">
TODO: Need to outline the risks of noalg signatures
</aside>

<aside class="notice">
TODO: Need to exposing client_id and scopes in Discovery
</aside>

<h3 id="mutual-tls">Mutual TLS</h3>

<p><a href="https://en.wikipedia.org/wiki/Mutual_authentication">Mutual TLS</a> (mTLS) can be used between an EHR and CDS Service and that would allow the CDS Service to establish trust of the EHR. However, if mTLS is used, this should be in addition to using JSON web tokens to establish trust of the EHR. As mTLS is not well supported across all platforms and technologies, it is not the standard means of establishing trust with the EHR.</p>

<h2 id="fhir-resource-access">FHIR Resource Access</h2>

<p>The CDS Service is able to use the FHIR server of the EHR to obtain any additional data it needs in order to perform its decision support. This is similar to SMART on FHIR where the SMART app can obtain additional data via the provided FHIR server.</p>

<p>Like SMART on FHIR, CDS Hooks requires that access to the FHIR server be controlled by an Authorization server utilizing the OAuth 2 framework. Thus, the CDS Service is able to consume the given FHIR server via an access (bearer) token just like a SMART app. While CDS Hooks shares the underlying technical framework and standards as SMART on FHIR, there are very important differences between SMART and CDS Hooks.</p>

<h3 id="obtaining-an-access-token">Obtaining an Access Token</h3>

<p>In SMART on FHIR, the SMART app requests and ultimately obtains an access token from the Authorization server using the SMART launch workflow. This process utilizes the authorization code grant model as defined by the OAuth 2.0 Authorization Framework in <a href="https://tools.ietf.org/html/rfc6749">rfc6749</a>.</p>

<p>With CDS Hooks, the EHR provides the access token directly in the request to the CDS Service. Thus, the CDS Service does not need to request the token from the authorization server as a SMART app would. This is done purely for performance reasons as the authorization code grant model in OAuth 2 involves several HTTPS calls and redirects. In contrast with a SMART app, a CDS Service may be invoked many times during a workflow. Going through the authorization code grant model on every hook invocation would likely result in a slow performing CDS Service due to the authorization overhead.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"fhirAuthorization"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"access_token"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"some-opaque-fhir-access-token"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"token_type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"code"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"expires_in"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w">
    </span><span class="nt">"scope"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"patient/Patient.read patient/Observation.read"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="access-token">Access Token</h3>

<p>The access token is specified in the CDS Service request via the <code class="prettyprint">fhirAuthorization</code> request parameter. This parameter is an object that contains both the access token as well as other related information.</p>

<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">access_token</code></td>
<td><em>string</em>. This is the OAuth 2 access token that provides access to the FHIR server.</td>
</tr>
<tr>
<td><code class="prettyprint">token_type</code></td>
<td><em>string</em>. Always the value <code class="prettyprint">code</code></td>
</tr>
<tr>
<td><code class="prettyprint">expires_in</code></td>
<td><em>integer</em>. The lifetime in seconds of the access token.</td>
</tr>
<tr>
<td><code class="prettyprint">scope</code></td>
<td><em>string</em>. The scopes the access token grants the CDS Service.</td>
</tr>
</tbody></table>

<p>It is recommended that the <code class="prettyprint">expires_in</code> value be very short lived as the access token should be treated as a transient value by the CDS Service.</p>

<p>It is recommended that the <code class="prettyprint">scope</code> value contain just the scopes that the CDS Service needs for its logic and no more.</p>

<p>As the CDS Service is executing on behalf of a user, it is important that the data the CDS Service has access to is under the same restrictions/authorization as the current user. As such, the access token should be scoped to:</p>

<ul>
<li>The CDS Service being invoked</li>
<li>The current user</li>
<li>The current patient</li>
</ul>

<h3 id="frequently-asked-questions">Frequently Asked Questions</h3>

<ol>
<li>How is the user (clinician) prompted to authorize the CDS Service to obtain an access token on behalf of the user? If we&rsquo;re aligning with how security works for SMART apps, this is what happens today.</li>
</ol>

<p>Not quite. There is actually no requirement that there be any user interaction to authorize a SMART app to obtain an access token. More generally, the OAuth 2 framework does not prescribe <em>how</em> authorization is determined. That is, authorization may be determined via some user interruptive decision, some pre-existing business rules, or even by random chance! The authorization server is free to determine how it grants access to the resources it protects.</p>

<p>With SMART on FHIR, we have seen real production behavior in which the authorization server:</p>

<ul>
<li>Grants access to practictioner facing SMART apps via some predefined business arrangement that was done out of bounds. The user (practitioner) never is asked to authorize the SMART app as their organization (hospital) has already made this decision for them.</li>
<li>Grants access to patient facing SMART apps by asking the user explicitly for permission to both launch the SMART app as well as what specific scopes (data permissions) the SMART app may havel</li>
</ul>

<ol>
<li>The FHIR access token model places quite a bit of work on the EHRs. Why?</li>
</ol>

<p>Yes, requiring the EHRs to obtain and share the access token with each CDS Service on each hook invocation isn&rsquo;t trivial work. However, the need to control the performance of the CDS Service invocations necessitates a different approach than SMART on FHIR. By putting the burden on the EHRs to obtain this access token, it is left to the EHR to manage this cost appropriately. Given the authorization server and EHR are controlled by the same organization, it is assumed the EHR is in a much better position to implement strategies to both obtain and manage access tokens in a performant manner in a model like CDS Hooks.</p>

<p>Unlike SMART apps, CDS Services should treat access tokens as transient tokens used during the course of a single evaluation of decision support. If the EHRs did not bear the responsibility of obtaining the access token on behalf of the CDS Service, each CDS Service would need to not only obtain the token themselves, but also determine a performant manner to optimize token (re)use when their service is invoked for the same user/patient.</p>

<h2 id="cross-origin-resource-sharing">Cross-Origin Resource Sharing</h2>

<p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS">Cross-origin resource sharing (CORS)</a> is web security mechanism that is built into browsers. In short, CORS allows servers to control how browsers access resources on the server, including the accessible HTTP response headers. CORS is only honored by web browsers and as such, is a client-side security mechanism.</p>

<p>For CDS Services, implementing CORS is required if your CDS Service is to be called from a web browser. As the <a href="http://sandbox.cds-hooks.org">CDS Hooks Sandbox</a> is a browser application, you must implement CORS to test your CDS Service in the CDS Hooks Sandbox.</p>

<p>You should carefully consider how you support CORS, but a quick starting point for testing would be to ensure your CDS Service returns the following HTTP headers:</p>

<table><thead>
<tr>
<th>Header</th>
<th>Value</th>
</tr>
</thead><tbody>
<tr>
<td>Access-Control-Allow-Credentials</td>
<td>true</td>
</tr>
<tr>
<td>Access-Control-Allow-Methods</td>
<td>GET, POST, OPTIONS</td>
</tr>
<tr>
<td>Access-Control-Allow-Origin</td>
<td>*</td>
</tr>
<tr>
<td>Access-Control-Expose-Headers</td>
<td>Origin, Accept, Content-Location, Location, X-Requested-With</td>
</tr>
</tbody></table>

          <h1 id="hook-catalog">Hook Catalog</h1>

<h2 id="pre-defined-cds-hooks">Pre-defined CDS hooks</h2>

<p>We describe a set of hooks to support common use cases out of the box.
But <strong>this is not a closed set</strong>; anyone can define new hooks to address new use
cases. To propose a new hooks please add it to the <a href="https://github.com/cds-hooks/docs/wiki/Proposed-Hooks">proposed hooks</a> page of our wiki.</p>

<p>Note that each hook (e.g. <code class="prettyprint">medication-prescribe</code>) represents something the user is doing in the EHR; various hooks might respond to the same hook (e.g. a &ldquo;price check&rdquo; service and a &ldquo;prior authorization&rdquo; service might both respond to <code class="prettyprint">medication-prescribe</code>).</p>

<p>Note also that each hook name in our official catalog is a simple string. If
you want to define custom hooks without submitting them to the catalog, then
you should use a URI (e.g.
<code class="prettyprint">http://my-organization/custom-hooks/patient-transmogrify</code>).</p>

<h2 id="medication-prescribe"><code class="prettyprint">medication-prescribe</code></h2>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"context"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MedicationOrder"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"medicationCodeableConcept"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"..."</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;snipped for brevity&gt;"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p><strong>Purpose</strong>: Inform an external CDS service that the user is in the process of
prescribing a new medication, and solicit feedback about the
prescription-in-progress.</p>

<p><strong>Contextual data</strong>: The set of proposed medication prescriptions. using the
FHIR <code class="prettyprint">MedicationOrder</code> resource. See example in the sidebar.</p>

<h2 id="order-review"><code class="prettyprint">order-review</code></h2>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"context"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DiagnosticOrder"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"..."</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;snipped for brevity&gt;"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p><strong>Purpose</strong>: Inform an external CDS service that the user is in the process of
reviewing a set of orders (sometimes known as a &ldquo;shopping cart&rdquo;), and solicit
feedback about the orders being reviewed.</p>

<p><strong>Contextual data</strong>: The set of orders being reviewed on-screen, represented
using a combination of MedicationOrder, DiagnosticOrder, DeviceUseRequest,
ReferralRequest, and ProcedureRequest. See example in the sidebar.</p>

<h2 id="patient-view"><code class="prettyprint">patient-view</code></h2>

<p><strong>Purpose</strong>: Inform an external CDS service that the user has just opened a new
patient record and is viewing a summary screen or &ldquo;face sheet&rdquo;, and solicit
feedback about this patient.</p>

<p><strong>Contextual data</strong>: None required beyond default context.</p>

          <h1 id="community">Community</h1>

<h2 id="get-involved">Get Involved</h2>

<p>There are several ways in which you can get involved with the CDS Hooks community.</p>

<ul>
<li>Ask a question and participate in discussions via the <a href="https://groups.google.com/forum/#!forum/cds-hooks">CDS Hooks Google Group</a></li>
<li>Chat via <a href="https://zulip.org/">Zulip</a> at <a href="https://chat.fhir.org">https://chat.fhir.org</a> in the <em>cds-hooks</em> stream</li>
<li>Contribute to the <a href="https://github.com/cds-hooks">code and documentation on Github</a></li>
<li>Check out the <a href="https://github.com/cds-hooks/docs/wiki/CDS-Services-for-testing">CDS services available for testing</a> and contribute your own.</li>
</ul>

<h2 id="cds-hooks-sprint-program">CDS Hooks Sprint Program</h2>

<h3 id="objectives">Objectives</h3>

<ul>
<li>Promote creation of clinical-grade service integrations (EHRs + CDS Services)</li>
<li>Gain implementation experience with real-world systems</li>
<li>Refine the spec, balancing ease of use, flexibility, and stability</li>
<li>Drive toward pilot deployments with the ability to measure results</li>
</ul>

<h3 id="want-to-help-build-our-test-infrastructure">Want to help build our test infrastructure?</h3>

<ul>
<li><strong><a href="https://github.com/cds-hooks/cds-hooks/labels/help%20wanted">help-wanted issues</a></strong></li>
<li><strong><a href="https://github.com/cds-hooks/cds-hooks/milestones">Proposed Milestones</a></strong></li>
</ul>

          <h1 id="examples">Examples</h1>

<h2 id="cdc-guideline-for-prescribing-opioids-for-chronic-pain">CDC Guideline for Prescribing Opioids for Chronic Pain</h2>

<blockquote>
<p>CDS Service Request</p>

<p>The example illustrates a prescription for Acetaminophen/Hydrocodone Bitartrate for a patient that already has a prescription for Oxycodone Hydrochloride:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"hookInstance"</span><span class="p">:</span><span class="w"> </span><span class="s2">"d1577c69-dfbe-44ad-ba6d-3e05e953b2ea"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"fhirServer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://fhir.example.com"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"hook"</span><span class="p">:</span><span class="w"> </span><span class="s2">"medication-prescribe"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"user"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Practitioner/example"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"context"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MedicationOrder"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"medrx001"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"dateWritten"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-05-05"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"draft"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"patient"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient/example"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"medicationCodeableConcept"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"coding"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://www.nlm.nih.gov/research/umls/rxnorm"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"857001"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"display"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Acetaminophen 325 MG / Hydrocodone Bitartrate 10 MG Oral Tablet"</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"dosageInstruction"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Take 1 tablet Oral every 4 hours as needed"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"timing"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"repeat"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="nt">"frequency"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w">
              </span><span class="nt">"frequencyMax"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w">
              </span><span class="nt">"period"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
              </span><span class="nt">"unit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"d"</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">},</span><span class="w">
          </span><span class="nt">"asNeededBoolean"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
          </span><span class="nt">"doseQuantity"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
            </span><span class="nt">"unit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mg"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://unitsofmeasure.org"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mg"</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"patient"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient/example"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"prefetch"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"medication"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"response"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"200 OK"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"resource"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MedicationOrder"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"medrx002"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"dateWritten"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-04-25"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"patient"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient/example"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"medicationCodeableConcept"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"coding"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
              </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://www.nlm.nih.gov/research/umls/rxnorm"</span><span class="p">,</span><span class="w">
              </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1049621"</span><span class="p">,</span><span class="w">
              </span><span class="nt">"display"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Oxycodone Hydrochloride 5 MG Oral Tablet"</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">]</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"dosageInstruction"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="nt">"text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Take 1 tablet by mouth every 4 hours as needed for pain."</span><span class="p">,</span><span class="w">
            </span><span class="nt">"timing"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="nt">"repeat"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"frequency"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w">
                </span><span class="nt">"period"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                </span><span class="nt">"periodUnits"</span><span class="p">:</span><span class="w"> </span><span class="s2">"d"</span><span class="w">
              </span><span class="p">}</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"asNeededBoolean"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="nt">"doseQuantity"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
              </span><span class="nt">"unit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mg"</span><span class="p">,</span><span class="w">
              </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://unitsofmeasure.org"</span><span class="p">,</span><span class="w">
              </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mg"</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>This example illustrates the use of the CDS Hooks <code class="prettyprint">medication-prescribe</code> hook to implement Recommendation #5 from the <a href="https://guidelines.gov/summaries/summary/50153/cdc-guideline-for-prescribing-opioids-for-chronic-pain---united-states-2016#420">CDC guideline for prescribing opioids for chronic pain</a>.</p>

<p>This example is taken from the <a href="http://build.fhir.org/ig/cqframework/opioid-cds/">Opioid Prescribing Support Implementation Guide</a>, developed in partnership with the Centers for Disease Control and Prevention <a href="https://www.cdc.gov/">(CDC)</a>.</p>

<blockquote>
<p>CDS Service Response</p>

<p>The opioid guideline request results in the following response that indicates the patient is at high risk for opioid overdose according to the CDC guidelines, and the dosage should be tapered to less than 50 MME. Links are provided to the guideline, as well as to the MME conversion tables provided by CDC.</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"summary"</span><span class="p">:</span><span class="w"> </span><span class="s2">"High risk for opioid overdose - taper now"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"indicator"</span><span class="p">:</span><span class="w"> </span><span class="s2">"warning"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"links"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CDC guideline for prescribing opioids for chronic pain"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"absolute"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://guidelines.gov/summaries/summary/50153/cdc-guideline-for-prescribing-opioids-for-chronic-pain---united-states-2016#420"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MME Conversion Tables"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"absolute"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://www.cdc.gov/drugoverdose/pdf/calculating_total_daily_dose-a.pdf"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"detail"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Total morphine milligram equivalent (MME) is 125mg. Taper to less than 50."</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h2 id="radiology-appropriateness">Radiology Appropriateness</h2>

<blockquote>
<p>CDS Service Request</p>

<p>This example illustrates the use of the CDS Hooks <code class="prettyprint">order-review</code> hook to implement Radiology Appropriateness scoring.</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"hookInstance"</span><span class="p">:</span><span class="w"> </span><span class="s2">"d1577c69-dfbe-44ad-ba6d-3e05e953b2ea"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"fhirServer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://fhir.example.com"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"hook"</span><span class="p">:</span><span class="w"> </span><span class="s2">"order-review"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"user"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Practitioner/example"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"context"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ProcedureRequest"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"procedure-request-1"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"draft"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"intent"</span><span class="p">:</span><span class="w"> </span><span class="s2">"proposal"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"priority"</span><span class="p">:</span><span class="w"> </span><span class="s2">"routine"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"coding"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
          </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://www.ama-assn.org/go/cpt"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"70450"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"display"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CT, head, wo iv contrast"</span><span class="w">
        </span><span class="p">}]</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"subject"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient/example"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"requester"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"agent"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Practitioner/exampmle"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"patient"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient/example"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>CDS Service Response</p>

<p>The appropriateness score is communicated via an update of the procedure request that adds an extension element to indicate the appropriateness rating.</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"cards"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"summary"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Usually appropriate"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"indicator"</span><span class="p">:</span><span class="w"> </span><span class="s2">"info"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"detail"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The requested procedure is usually appropriate for the given indications."</span><span class="p">,</span><span class="w">
      </span><span class="nt">"suggestions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The appropriateness score for this procedure given these indications is 9, usually appropriate."</span><span class="p">,</span><span class="w">
          </span><span class="nt">"actions"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
            </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"update"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Update the order to record the appropriateness score."</span><span class="p">,</span><span class="w">
            </span><span class="nt">"resource"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ProcedureRequest"</span><span class="p">,</span><span class="w">
              </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"procedure-request-1"</span><span class="p">,</span><span class="w">
              </span><span class="nt">"extension"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                  </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://hl7.org/fhir/us/qicore/StructureDefinition/procedurerequest-appropriatenessScore"</span><span class="p">,</span><span class="w">
                  </span><span class="nt">"valueDecimal"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9"</span><span class="w">
                </span><span class="p">}</span><span class="w">
              </span><span class="p">],</span><span class="w">
              </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"draft"</span><span class="p">,</span><span class="w">
              </span><span class="nt">"intent"</span><span class="p">:</span><span class="w"> </span><span class="s2">"proposal"</span><span class="p">,</span><span class="w">
              </span><span class="nt">"priority"</span><span class="p">:</span><span class="w"> </span><span class="s2">"routine"</span><span class="p">,</span><span class="w">
              </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"coding"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
                  </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://www.ama-assn.org/go/cpt"</span><span class="p">,</span><span class="w">
                  </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"70450"</span><span class="p">,</span><span class="w">
                  </span><span class="nt">"display"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CT, head, wo iv contrast"</span><span class="w">
                </span><span class="p">}]</span><span class="w">
              </span><span class="p">},</span><span class="w">
              </span><span class="nt">"subject"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patient/example"</span><span class="w">
              </span><span class="p">},</span><span class="w">
              </span><span class="nt">"requester"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"agent"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                  </span><span class="nt">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Practitioner/exampmle"</span><span class="w">
                </span><span class="p">}</span><span class="w">
              </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">}]</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="code">code</a>
          </div>
      </div>
    </div>
  </body>
</html>
